<!DOCTYPE html>
<html>
<head>
	<title>HTML5 Canvas HexGrid map with mouse mapping</title>
	<meta name="Author" content="Nicu Pavel, npavel@linuxconsulting.ro"/>
	<meta name="description" content="Hexagonal Grid Map with mouse coordinates pixel to hex conversion"/>
	<script>
		var s = 36; //hexagon segment size
		var h = s / 2;
		var r = s * 0.886025404;

		function drawHex(c, x0, y0) {
			c.strokeStyle = '#555';

			c.beginPath();
			c.moveTo(x0, y0);
			c.lineTo(x0 + s, y0);
			c.lineTo(x0 + s + h, y0 + r);
			c.lineTo(x0 + s, y0 + 2 * r);
			c.lineTo(x0, y0 + 2 * r);
			c.lineTo(x0 - h, y0 + r);

			c.fillStyle = '#DDD';
			c.fill();

			c.stroke();
			c.closePath();
		}

		function drawHexGrid(c, x, y, rows, cols) {
			var posx;
			var posy;
			var n;
			var coord;

			for (var row = 0; row < rows; row++) {
				//we space the hexagons on each line next column being on the row below
				for (var col = 0; col < cols / 2; col++) {
					var posx = (row & 1 ) * (h + s) + x + 2 * col * (s + h);
					var posy = y + row * r;
					drawHex(c, posx, posy);
				}
			}
		}

		function renderStart() {
			var MAP_ORIGIN_X = 0;
			var MAP_ORIGIN_Y = 0;
			var MAP_COLS = 12;
			var MAP_ROWS = 15;

			var statusText = document.getElementById('mousestatus');
			var canvas = document.getElementById('hex');
			var c = canvas.getContext('2d');

//			canvas.addEventListener("click",
//					function(e) {
//						var mx, my, tcol, vcol, trow, vrow,  posx, posy;
//
//						mx = e.clientX - canvas.offsetLeft;
//						my = e.clientY - canvas.offsetTop;
//						//a graphical column in the grid not the array column
//						vcol = parseInt(mx / (s + h));
//						//real array column
//						tcol = parseInt(vcol / 2);
//						// a graphical row not the array row
//						vrow = parseInt((my + r * (~vcol & 1)) / r);
//
//						//shift to correct row index
//						if (vcol & 1) {
//							trow = vrow - 1;
//						}
//						else {
//							trow = vrow - 2;
//						}
//
//						//Add top offset (r) if graphical column is even substract if odd
//						posy = MAP_ORIGIN_Y + r * (vcol & 1) - r * (vcol & 1) + trow * r;
//						posx = (trow & 1 ) * (h + s) + MAP_ORIGIN_X + 2 * tcol * (s + h);
//
//						if ((vcol <= MAP_COLS) && (trow <= MAP_ROWS)) {
//							drawHex(c, posx, posy, null, "blue", null, null);
//							statusText.value = "Mouse at: X:" + mx + " Y:" + my + " Hex is at: Col:" + tcol + " Row:" + trow + " VCol:" + vcol + " VRow:" + vrow;
//						}
//						else {
//							statusText.value = "Outside Map";
//						}
//
//					},
//					false);

			drawHexGrid(c, MAP_ORIGIN_X, MAP_ORIGIN_Y, MAP_ROWS, MAP_COLS);
		}
	</script>
</head>
<body onload="renderStart();">

<canvas id="hex" width="800" height="700"></canvas>

</body>
</html>